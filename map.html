<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }
        .leaflet-marker-icon {
            border-radius: 50%;
            border: 2px solid black;
            background: transparent;
        }
        .leaflet-popup-content {
            width: 150px;
        }
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f9f9f9;
            border: 2px solid #333;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 300px;
            font-size: 14px;
        }
        #controls h3 {
            margin-top: 0;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
        }
        #controls ul {
            list-style: none;
            padding: 0;
        }
        #controls li {
            margin-bottom: 8px;
        }
        #controls strong {
            display: inline-block;
            width: 150px;
            font-weight: bold;
            color: #555;
        }
        #controls li:last-child {
            margin-bottom: 0;
        }
        .user-position-icon,
        .additional-icon {
            font-size: 24px;
            color: black;
            background: transparent;
        }
        .user-position-ring {
            stroke: #FF5722;
            stroke-width: 2;
            stroke-dasharray: 4;
            fill: none;
        }
        .circle {
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black; /* Icon colour */
            background-color: white;
            font-size: 24px;
            line-height: 1;
            border: none;
        }
        .circle.red { background-color: white; }
        .circle.blue { background-color: white; }
        .circle.green { background-color: white; }
        .circle.purple { background-color: white; }
        #map-mode-toggle {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        #map-mode-toggle label {
            margin-right: 10px;
        }
        #map-mode-toggle select {
            padding: 5px;
        }
        #map-actions {
            margin-top: 10px;
        }
        #map-actions button {
            padding: 8px 12px;
            font-size: 14px;
            margin-right: 10px;
            cursor: pointer;
        }
        #map-actions button.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="controls">
        <h3>Map Controls</h3>
        <ul>
            <li><strong>Click:</strong> Add Point or Draw Line</li>
            <li><strong>Drag:</strong> Pan Map</li>
            <li><strong>Scroll Wheel:</strong> Zoom In/Out</li>
        </ul>
        <div id="map-actions">
            <button id="add-point" class="active">Add Point</button>
            <button id="draw-line">Draw Line</button>
        </div>
        <div id="map-mode-toggle">
            <label for="map-mode">Map Type:</label>
            <select id="map-mode">
                <option value="osm">OpenStreetMap</option>
                <option value="stamen-terrain">Stamen Terrain</option>
                <option value="carto-light">Carto Light</option>
            </select>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const map = L.map('map').setView([-37.814, 144.963], 13); // Melbourne

            let currentBaseLayer;

            function updateTileLayer(layerType) {
                if (currentBaseLayer) {
                    map.removeLayer(currentBaseLayer);
                }

                const tileLayers = {
                    osm: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                    'stamen-terrain': 'https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}{r}.png?api_key=5a677b5d-7b56-450a-b358-2d5a5a8af829',
                    'carto-light': 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png'
                };

                currentBaseLayer = L.tileLayer(tileLayers[layerType], {
                    attribution: layerType === 'osm'
                        ? '© OpenStreetMap contributors'
                        : '© OpenStreetMap contributors, © Stamen Design, © CartoDB'
                }).addTo(map);
            }

            updateTileLayer('osm'); // Set default layer to OpenStreetMap

            const points = [];
            let lines = [];
            let mode = 'add-point'; // Default mode

            const markersLayer = L.layerGroup().addTo(map);
            const linesLayer = L.layerGroup().addTo(map);

            // Define user position icon with Material Icons
            const userIcon = L.divIcon({
                className: 'user-position-icon',
                html: '<i class="material-icons">flight</i>',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            // Define additional icons
            const icons = {
                plane: L.divIcon({
                    className: 'user-position-icon',
                    html: '<i class="material-icons">flight</i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                }),
                star: L.divIcon({
                    className: 'additional-icon',
                    html: '<i class="material-icons">star</i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                }),
                heart: L.divIcon({
                    className: 'additional-icon',
                    html: '<i class="material-icons">favorite</i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                }),
                check: L.divIcon({
                    className: 'additional-icon',
                    html: '<i class="material-icons">check</i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                }),
                alert: L.divIcon({
                    className: 'additional-icon',
                    html: '<i class="material-icons">warning</i>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                })
            };

            let userMarker;
            let userRing;

            // Function to update user position marker and ring
            function updateUserPosition(latlng) {
                if (userMarker) {
                    map.removeLayer(userMarker);
                }
                if (userRing) {
                    map.removeLayer(userRing);
                }

                userRing = L.circle(latlng, {
                    radius: 3000, // Radius of the ring in meters
                    color: '#FF5722', // Orange color
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0,
                    strokeDasharray: '4, 4' // Dotted border attempt
                }).addTo(map);

                userMarker = L.marker(latlng, {icon: icons.plane}).addTo(map);
            }

            const userPosition = { lat: -37.814, lng: 144.963 }; // Central Melbourne
            updateUserPosition(userPosition);

            // Add additional icons at different locations
            const additionalPositions = [
                { lat: -37.805, lng: 144.963, icon: icons.star },
                { lat: -37.804, lng: 144.913, icon: icons.heart },
                { lat: -37.824, lng: 144.933, icon: icons.check },
                { lat: -37.844, lng: 144.953, icon: icons.alert }
            ];

            additionalPositions.forEach(pos => {
                L.marker([pos.lat, pos.lng], { icon: pos.icon }).addTo(map);

                L.circle([pos.lat, pos.lng], {
                    radius: 3000,
                    color: pos.icon.options.html.includes('red') ? '#FF0000' :
                    pos.icon.options.html.includes('blue') ? '#0000FF' :
                    pos.icon.options.html.includes('green') ? '#00FF00' :
                    '#800080',
                    weight: 2,
                    opacity: 0.5,
                    fillOpacity: 0
                }).addTo(map);
            });

            function drawPoints() {
                markersLayer.clearLayers();
                points.forEach(point => {
                    L.marker([point.lat, point.lon], {draggable: true}).addTo(markersLayer);
                });
            }

            function drawLines() {
                linesLayer.clearLayers();
                lines.forEach(line => {
                    if (line.start && line.end) {
                        L.polyline([[line.start.lat, line.start.lon], [line.end.lat, line.end.lon]], {
                            color: 'black',
                            weight: 2
                        }).addTo(linesLayer);
                    }
                });
            }

            // Handle map click to add points or draw lines based on mode
            map.on('click', function(event) {
                const coords = event.latlng;
                if (!coords) return;

                const pointCoords = {
                    lat: coords.lat,
                    lon: coords.lng
                };

                if (mode === 'add-point') {
                    points.push(pointCoords);
                    drawPoints();
                } else if (mode === 'draw-line') {
                    points.push(pointCoords);
                    drawPoints();

                    // Draw a line connecting the last two points if they exist
                    if (points.length > 1) {
                        const lastPoint = points[points.length - 1];
                        const secondLastPoint = points[points.length - 2];
                        lines.push({ start: secondLastPoint, end: lastPoint });
                        drawLines();
                    }
                }
            });

            // Toggle map action mode
            document.getElementById('add-point').addEventListener('click', function() {
                mode = 'add-point';
                this.classList.add('active');
                document.getElementById('draw-line').classList.remove('active');
            });

            document.getElementById('draw-line').addEventListener('click', function() {
                mode = 'draw-line';
                this.classList.add('active');
                document.getElementById('add-point').classList.remove('active');
            });

            // Map mode toggle
            document.getElementById('map-mode').addEventListener('change', function() {
                updateTileLayer(this.value);
            });

            // Initialize with default map mode - OSM
            updateTileLayer('osm');
        });
    </script>
</body>
</html>
